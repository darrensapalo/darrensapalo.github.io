<!DOCTYPE html>
<html>
<head>
	<title>Swifty models</title>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

	<script type="text/javascript">
	function capitalizeFirstLetter(string) {
	    return string.charAt(0).toUpperCase() + string.slice(1);
	}
	var fields, fieldlist;
	$(document).ready(function() {
		
		$("#Reset").click(function(e) {
			$("#model_name").val("")
			$("#field_list").val("")
		});

		$("#Produce").click(function(e){
			var modelName = $("#model_name").val()
			fieldlist = $("#field_list").val().trim()

			if (modelName == "") {
				alert("Please set the model name.")
				return
			}

			if (fieldlist == "") {
				alert("Please set a value for the field list.")
				return
			}

			modelName = capitalizeFirstLetter(modelName)

			initialFieldList = fieldlist.trim()

			fieldlist = fieldlist.replace("public static var fields", "")
			fieldlist = fieldlist.replace("[String]", "")
			fieldlist = fieldlist.replace("[", "")
			fieldlist = fieldlist.replace("]", "")
			fieldlist = fieldlist.replace(/:/, "")
			fieldlist = fieldlist.replace(/=/, "")
			fieldlist = fieldlist.replace(/\"/g, "")
			fieldlist = fieldlist.replace(/, /g, ",")
			fieldlist = fieldlist.trim()
			fields = fieldlist.split(",")

			var sb = ""
			sb += initialFieldList
			sb += "\n\n"
			sb += "required public convenience init(fromDictionary dictionary: NSDictionary) throws {\n"
			sb += "self.init()\n"
			for(i = 0; i < fields.length; i++) {
				sb += fields[i] + " = try " + modelName + ".get(\"" + fields[i] + "\", from: dictionary)\n"
			}
			sb += "\n}\n\n"

			sb += "init() { }\n"

			$("#result").html(sb)

			sb = "public func == (lhs: " + modelName + ", rhs: " + modelName + ") -> Bool {\n"
		    sb += "return lhs.id == rhs.id\n"
			sb += "}\n"

			$("#equatable").html(sb)
		})
	})
	</script>
</head>
<body>

<div class="container">
<p>
	<h1>
		Hi there!
	</h1>
	Let's make swift models easier to migrate. Given the field list and model name, this tool will produce the constructor of that model.
</p>

<div class="row">
	<div class="col-md-6">
		<b>Model name</b>
		<input type="text" class="form-control" id="model_name" placeholder="Allergy">

		<hr>

		<b>Field list</b>
		<textarea class="form-control" rows=5 id="field_list"></textarea>
		<br>
		<p class="help-block">This will trim the extra whitespace and swift variable declaration, so feel free to enter sample data like the one below:</p>
		<b>Example</b>
		<pre>public static var fields : [String] = ["id", "type", "severity", "reaction", "notes", "PatientId", "other", "TimeCreated"]</pre>
		<input type="submit" class="btn btn btn-primary" id="Produce" value="Generate Code">
		<input type="submit" class="btn btn btn-secondary" id="Reset" value="Reset">
	</div>

	<div class="col-md-6">
		<strong>Result</strong>
			<textarea id="result" class="form-control" rows=6></textarea>
			<BR />
		<strong>Equatable implementation</strong>
			<textarea id="equatable" class="form-control" rows=6></textarea>
			<BR />
			<p class="help-block">
				Copy the constructors and paste it inside the class. Copy the equatable function and paste it in the same file, but outside the class.
			</p>
	</div>
</div>


</div>

</body>
</html>